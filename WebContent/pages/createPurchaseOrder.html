<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Add Material | STOMAN</title>
<link href="../resources/uniform.default.css" rel="stylesheet"
	type="text/css" media="all">
<link href="../resources/uniform.aristo.css" rel="stylesheet"
	type="text/css" media="all">
<link href="../resources/style.css" rel="stylesheet" type="text/css"
	media="all">
<link href="../resources/jquery.autocomplete.css" rel="stylesheet" type="text/css" media="all">
<script src="../resources/jquery-1.4.js" type="text/javascript"></script>
<script src="../resources/jquery.uniform.min.js" type="text/javascript"></script>
<script type='text/javascript' src='../dwr/engine.js'></script>
<script type='text/javascript' src='../dwr/util.js'></script>
<script type='text/javascript' src='../dwr/interface/Material.js'></script>
<script type='text/javascript' src='../resources/common.js'></script>
<script type='text/javascript' src='../resources/jquery.autocomplete.js'></script>

<script type="text/javascript">
	$(document).ready(function(){
		pageInit('cpo');
		$('#material').autocomplete('../auto/complete', { 
			matchContains: true,
			cacheLength: 10,
			maxItemsToShow: 9,
			extraParams: { method: 'getMaterials' }
		});
		
		//fetchMaterials();
	});

	function fetchMaterials(){
        Material.getMaterials(function(map){
            if(null!=map){
            	var select = $('#select');
      		  	var options = select.attr('options');
            		$.each(map, function(key, value) { 
            		  options[options.length] = new Option(value, key);
            		});
            }
        });
	}
	
	function create() {
		var page = $('#add-material'); 
		preAjax(page);
		Material.create(dwr.util.getValues('add-material'), function(stat) {
			postAjax(page);
			var cn = detectAndDoClassName(stat);
			var type = detectAndDoType(stat, 'create-purchaseorder');
			acknowledge(cn, stat, type);
		});
	}

	function generate() {
		var obj = {};
		$('#orders tr').not('#header').each(function(i, tr) {
			//alert(i);
			//alert(tr);
			var material = $(tr).find('#material');
			var quantity = $(tr).find('#quantity');
			if(material.val().trim() != '')
				obj[material.val()] = obj[material.val()] 
						? obj[material.val()] + parseInt(quantity.val())
						: parseInt(quantity.val());
		});
	}

	function createOrder() {
		var order = $('#order-clone');
		var nOrder = order.clone().appendTo($('#orders'));
		order.removeAttr('id');
		auto(nOrder.find('#material'));
		nOrder.find('#material').val('');
		nOrder.find('#quantity').val('');
		order.find('#cntrl label').remove();
		$('#remove-clone label').clone()
			.removeAttr('id')
			.appendTo(order.find('#cntrl')).css('display', 'inline');
		parent.setIframeHeight('create-purchase-order');
	}
	
	function deleteOrder(obj) {
		$(obj.parentNode.parentNode).remove();
		parent.setIframeHeight('create-purchase-order');
	}
	
	var ii = 0;
	function testOrders(n) {
		$('<div/>').html('test' + ii++).css('float', 'left').insertBefore($(n));
	}
</script>

</head>
<body >
<form id="create-purchaseorder">
<table width="100%" style="padding-top: 20px;">
<tbody id="orders">
	<tr id="header">
		<td align="center"><label name="name_lbl">Material</label></td>
		<td align="center"><label name="quantity_lbl">Quantity</label></td>
		<td></td>
		<td id="remove-clone" style="display: none;"><label onclick="deleteOrder(this);" class="remove">-</label></td>
	</tr>
	<tr id="order-clone">
		<td><input id="material1" class="text" onkeypress="$(this.parentNode.nextSibling.nextSibling.nextSibling).find('input').attr('name', $(this).val())"/>
		</td>
		<td><input id="quantity" class="text"/></td>
		<td id="cntrl"><label onclick="createOrder(this);" class="add">+</label></td>
		<td></td>
	</tr>
	<tr id="test-orders">
		<td colspan="4">
		<div onclick="testOrders(this)" style="float: left;">+</div>
		</td>
	</tr>
	<tr id="test-orders">
		<td colspan="4">
			<div><span>100</span> </span><span><input type="text" class="text" id="material"/></span></div>
		</td>
	</tr>
</tbody>	
</table>
<table width="100%">
	<tr>
		<td colspan="4" align="center" style="padding-top: 20px;"><a
			id="create" class="awesome green" href="#" onclick="generate();">Generate</a>
		<a class="awesome green" href="#" onclick="fresh('create-purchaseorder')">Clear</a>
		</td>
	</tr>
</table>
</form>

</body>
</html>