<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Add Material | STOMAN</title>
<link href="../resources/uniform.default.css" rel="stylesheet"
	type="text/css" media="all">
<link href="../resources/uniform.aristo.css" rel="stylesheet"
	type="text/css" media="all">
<link href="../resources/style.css" rel="stylesheet" type="text/css"
	media="all">

<link href="../resources/jquery.autocomplete.css" rel="stylesheet" type="text/css" media="all">
<script src="../resources/jquery-1.4.js" type="text/javascript"></script>
<script src="../resources/jquery.uniform.min.js" type="text/javascript"></script>
<script type='text/javascript' src='../dwr/engine.js'></script>
<script type='text/javascript' src='../dwr/util.js'></script>
<script type='text/javascript' src='../dwr/interface/Material.js'></script>
<script type='text/javascript' src='../resources/common.js'></script>
<script type='text/javascript' src='../resources/jquery.autocomplete.js'></script>
<script type='text/javascript' src='../dwr/interface/PurchaseOrder.js'></script>



<script type="text/javascript">

var order;
var minus;

	$(document).ready(function(){
		$('#material').autocomplete('../auto/complete', { 
			matchContains: true,
			mustMatch: 1,
			cacheLength: 10,
			maxItemsToShow: 3,
			delay: 1,
			handleMustMatch:true,
			minChars: 0,
			extraParams: { method: 'getMaterials' }
		});
		pageInit('cpo');
		order = $('#order-clone').clone();
		$('label.remove').live('click', function() {
			$(this).parents('tr').remove();
		});
		minus = $('<label/>').html('-').addClass('remove');


	});

	function generate() {
		var obj = {};
		$('#orders tr').each(function(i, tr) {
			//alert('sdfd');
			var material = $(tr).find('#material');
			var quantity = $(tr).find('#qty');
			if(material.val() != '' && quantity.val() != '')
				obj[material.val()] = obj[material.val()] 
						? obj[material.val()] + parseInt(quantity.val())
						: parseInt(quantity.val());
		});
		PurchaseOrder.generate(obj, function(data) {
			var po = $('#po-confirm');
			//po.innerHTML = "";
			
			$.each(data, function(vId, vM) {
				$.each(vM, function(i, ele) {
					$('<div/>').html(ele.materials.name).appendTo(po);
				});
			});
		});
	}
	
	function handleMustMatch(ele) {
		alert(ele);
	}

	function addOrder() {
		order.clone().appendTo('#orders').find('.add')
			 .replaceWith(minus.clone());
	}

</script>

</head>
<body >
<form id="create-purchaseorder">
<table width="100%" style="padding-top: 20px;">
<tbody id="orders">
	<thead>
		<tr>
			<th>
				Material
			</th>
			<th>
				Quantity
			</th>
		</tr>
	</thead>
	<tr id="order-clone">
		<td>
			<input id="material" type="text" class="text" />
		</td>
		<td>
			<input id="qty" type="text" class="text" />
		</td>
		<td>
			<label id="cntrl" class="add" onclick="addOrder();">+</label>
		</td>
	</tr>
</tbody>	
</table>
</form>
</body>
</html>